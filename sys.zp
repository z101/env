#!/usr/local/plan9/bin/rc

# consecutive patch applier
# /usr/local/bin/zp

maxpnum='99'
while(! ~ $1 ''){
	switch($1){
	case [0-9] [1-9][0-9]
		maxpnum=$1
	}
	shift
}
echo param: max patch num '=' $maxpnum
patches=`{eval ls -p | sort | grep 'patch\.[0-9][0-9]\.*' | head -$maxpnum}
for(f in $patches){
	echo ' -' applying $f...
	if(! patch -p1 < $f){
		echo [ERROR] patch "$f" failed
		exit 1
	}
}
